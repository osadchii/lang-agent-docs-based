# Пользовательские сценарии

## Основные роли
- Ученик (студент)
- Учитель (преподаватель)
- Администратор

## Сценарии ученика

### UC-0 Первый вход
Когда пользователь первый раз заходит в бота, бот должен спросить, какой язык хочет изучать пользователь, какой у него текущий уровень и какая цель по уровню. Так же надо спросить прикладную цель - работа, экзамен и т.д. Эти настройки сохраняются для пользователя, причем для одного пользователя может быть больше одной настройки для каждого языка (пользователь после первого входа может добавлять профили для других языков и переключаться между ними). После активации бота пользователь может настраивать профили (например, если он повысил свой уровень или наоборот, понял что выбранный уровень для него слишком большой). Бот так же должен спросить, на каком языке бот должен взаимодействовать с пользователем - на русском или на изучаемом языке. При этом "оборотная" сторона карточек всегда будет на русском, язык взаимодействия - это именно про ответы, интерфейс кнопок и т.д. Выбранный профиль пользователя должен влиять на системный промпт бота, куда мы должны подставлять текущий уровень, язык и цель пользователя, чтобы учитель-ллм учитывал это при ответах.

### UC-1: Диалог с помощником
Любой пользователь, независимо от роли, может задавать вопросы, например, но не исключая другие, с просьбой объяснить тему, перевести слово или предложение, подобрать синонимы или антонимы, найти похожие слова, проверить упражнение или попросить проверить знания. Бот должен с помощью ЛЛМ отвечать пользователю так, будто он является профессиональным преподавателем выбранного языка. Подробно, но без лишних деталей. Четко, уверенно и исчерпывающе. Пользователь может обращаться к последним своим сообщениям или сообщениям бота, бот должен учитывать этот контекст.

### UC-2: Добавление слов и фраз на лету
Карточки можно добавить несколькими способами: например, попросив напрямую, "Добавь лето в карточки", бот поймет, какое слово надо добавить и добавит его, если его еще не было в списке слов пользователя (независимо от колоды), сразу отобразит, что добавилось - слово, перевод, пример и перевод примера. При переводе слова бот тоже должен предлагать добавить его, притом предлагать кнопкой под переводом, чтобы пользователю не приходилось самому вызывать команду или просьбу дополнительно. Пользователь может попросить добавить сразу несколько слов, например "Добавь времена года", и бот сформирует 4 карточки "Зима", "Лето", "Осень" и "Весна" с переводом, примером и переводом примера. Карточки так же можно добавлять вручную через фронтенд разово или группой. Тоже с использованием ЛЛМ. Примеры и перевод вручную править пользователь не может - они всегда создаются только через ллм. При добавлении слова через бота, под добавленным словом должна быть кнопка "Удалить карточку", которая удаляет только что добавленное слово из карточек пользователя, если он случайно добавил её. Карточки привязаны к активному профилю-языку.

### UC-3: Работа с карточками
Карточки можно изучать в боте или на фронте (в миниаппе). В боте карточка должна вызываться кнопкой "Взять карточку", которая отображается под каждым сообщением бота, если не пришлось показать другие карточки (например, добавить в карточки). При нажатии на кнопку, бот берет наиболее актуальную для повторения карточку и показывает её с примером на языке "стороны" карточки. Сторона карточки выбирается случайно для единичных слов. Под карточкой находится кнопка "Перевернуть карточку", в боте эта кнопка добавляет в сообщение с карточкой её перевод и перевод  примера. А под карточкой появляются кнопки "Не знаю", "Повторить" и "Знаю". В зависимости от выбранного ответа, выбирается интервал, когда карточка появится снова для повтора (не знаю - быстро, повторить - попозже, знаю - еще позже Алгоритм используется в анки карточках). В миниаппе по кнопке "Перевернуть" карточка визуально реально переворачивается, и её можно переворачивать сколько угодно раз. Но после первого перевода становятся доступны те же варианты - "Не знаю", "Повторить" и "Знаю". Карточки привязаны к активному профилю-языку.

### UC-4: Выполнение упражнений
Пользователь может добавлять темы для изучения. Это может быть как темы из жизни - например, работа, бизнес. тогда бот может придумывать предложения на заданную тему и давать пользователю на перевод, с учетом его уровня. Так и какие-то темы из языка, например, прошедшее время, тогда бот может давать пользователю слово или предложение в настоящем времени, которую надо переделать в прошедшее, опять же, с учетом уровня пользователя. На фронтенде нужно комбинировать подходы - давать вводить свободный текст как ответы и проверять его, так и предлагать варианты ответа на выбор, где правильный ответ только один, а остальные ответы хоть и в тему, но неправильные. Через бота пользователь может только добавлять темы или выбирать темы для упражнений. Добавлять можно через свободный текст, например "Добавь тему прошедшнего времени", так и через команду /add_topic "название темы", через миниапп можно так же удалять темы. Через бота чтобы получить упражнение на какую-то тему, нужно нажать кнопку "Упражнение", которая оторбражается под каждым сообщением бота, вместе с "Взять карточку". Кнопка отображается только если у пользователя есть темы для обучения. В боте можно выбрать "активную" тему. Тема выбирается через команду /topics, которая отображает все темы с пейджингом в виде кнопок, пользователь может нажать на любую тему и "активировать её". Темы упражнений привязаны к активному профилю-языку.

### UC-5: Работа с изображениями
Если пользователь присылает изображение (сжатое или не сжатое), то бот распознает текст на изучаемом языке и присылает его в ответ. Если текст на изучаемом языке не найден, то бот так и пишет. В сообщении с распознанным текстом нужно проверить все слова или устойчивые выражения, которых нет в карточках пользователя, выбрать наиболее "ценную" или "популярную" и предложить добавить в карточки пользователя. Пользователь может прислать какой-то свой текст вместе с фото, например, попросить перевести (тут понятно), попросить проверить упражнение или домашнее задание (например, если это фото учебника или если это рукописный текст, тогда пользователь может описать суть задания). Или попросить решить задание - тогда в тексте могут быть пропуски, тест или что-то подобное, на что бот должен предложить решение.

### UC-6: Голосовые сообщения
Пользователь может присылать голосовые сообщения, которые бот должен распознать и работать с ними как с текстом - отвечать тоже текстом. Если это возможно, бот может оценить произношение, если текст на изучаемом языке, либо просто перевести или отреагировать на текст пользователя по описанным сценариям.

### UC-7: Участие в группе обучения
Если пользователь является частью группы, ему шарятся темы для изучения, колоды с карточками. При этом ученик не может редактировать их, только практиковать.

### UC-8: Отслеживание прогресса
Пользователь может через команду /stats отслеживать свою статистику или через фронтенд через соответствующий раздел. Статистика содержит данные о количестве изученных карточек, сделанных упраженений, заданных вопросов по каждому своему профилю. По каждому профилю ведется "стрик" - количество дней, во время которых пользователь занимался подряд. Если пользователь не закрыл сегодня стрик (и он больше 1 дня), то ему приходит уведомление за 6 часов до конца дня, что нужно позаниматься, чтобы сохранить стрик. Если стрик сорван, то уведомления не приходят. То есть если пользователь решил не заниматься дальше, он не будет получать уведомлений, кроме первого раза. Уведомление должно быть персонализированным, сгенерированным ллм.

## Сценарии учителя

### UC-8: Создание и управление группой
Учитель может пользоваться ботом как ученик, но при этом может создавать группы. Групп может быть несколько. Добавлять пользователей в группы можно специальной командой с подтверждением, "/add_to_group <user>", при этом юзером может быть chatid, nickname\username или ссылка на телеграм. Если пользователя нет в списке участников бота, то сообщается ошибка. Если пользователь найден, ему приходит предложение вступить в группу, при подтверждении или отклонении, учителю присылается уведомление о решении пользователя. 

### UC-9: Создание заданий для учеников
Учитель может создавать топики или колоды карт, которые он может шарить с одной или несколькими группами учеников. Шарить можно через фронтенд, через бота нельзя. При шаринге ученикам приходит уведомление, что с ними что-то пошарили. При изменении учителем пошаренных тем или пошаренных колод, это автоматическо обновляется и у учеников. 

## Сценарии администратора

### UC-10: Управление подписками
Бот содержит интеграцию со страйпом. При оплате страйпа на месяц пользователю выдается премиум. Администратор может через фронтенд смотреть пользователей и их статус. Администратор может выдать пользователю премиум вручную на фронте.

### UC-11: Мониторинг системы
Адмнистратор может смотреть список пользователей и их активность (сколько вопросов задали, сколько карточек посмотрели, сколько упражнений сделали. По пользователям доступна базовая информация - имя, фамилия, изучаемые языки, уровень, дата регистрации, статус премиум)
