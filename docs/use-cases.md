# Пользовательские сценарии

## Базовые сценарии использования

### UC-0: Первый вход и настройка профиля

**Начальная настройка:**
При первом запуске бота пользователь проходит онбординг, где указывает:
- Какой язык хочет изучать
- Текущий уровень владения языком (A1-C2)
- Целевой уровень
- Прикладную цель изучения (работа, экзамен, путешествия и т.д.)
- Язык интерфейса бота (русский или изучаемый язык)

**Профили языков:**
- Пользователь может создавать несколько профилей для разных языков
- Можно переключаться между профилями
- Профили можно редактировать в любой момент (изменить уровень, цель и т.д.)

**Язык интерфейса:**
- Определяет язык ответов бота, кнопок и интерфейса
- Переводы на карточках всегда отображаются на русском языке (независимо от языка интерфейса)

**Влияние на LLM:**
Выбранный профиль подставляется в системный промпт, чтобы LLM учитывал текущий уровень, изучаемый язык и цели пользователя при формировании ответов.

### UC-1: Диалог с помощником

Любой пользователь может вести диалог с ботом на естественном языке. Бот выступает в роли профессионального преподавателя изучаемого языка.

**Возможные запросы:**
- Объяснить грамматическую тему
- Перевести слово или предложение
- Подобрать синонимы или антонимы
- Найти похожие слова
- Проверить упражнение
- Проверить знания (тест, викторина)

**Стиль ответов:**
- Подробно, но без лишних деталей
- Четко, уверенно и исчерпывающе
- Адаптировано под уровень пользователя

**Контекстность:**
Бот учитывает историю диалога и может отвечать на вопросы, ссылающиеся на предыдущие сообщения пользователя или бота.

### UC-2: Добавление слов и фраз на лету

**Способы добавления через бота:**

1. **Текстовый запрос:**
   - "Добавь лето в карточки" — бот распознает слово и добавляет его
   - "Добавь времена года" — бот создает несколько карточек (Зима, Лето, Осень, Весна)
   - Проверка дубликатов: слово не добавляется, если уже есть у пользователя (независимо от колоды)

2. **Кнопка "Добавить в карточки":**
   - Отображается под переводом слова
   - Позволяет добавить карточку одним нажатием

**Содержимое карточки:**
При добавлении LLM автоматически генерирует:
- Слово на изучаемом языке
- Перевод на русский
- Пример использования
- Перевод примера

**Добавление через Mini App:**
- Можно добавлять карточки вручную (по одной или группой)
- Контент также генерируется через LLM
- Примеры и переводы нельзя редактировать вручную

**Отмена добавления:**
Под только что добавленной карточкой отображается кнопка "Удалить карточку" для отмены ошибочного добавления.

**Привязка к профилю:**
Карточки привязаны к активному языковому профилю пользователя.

### UC-3: Работа с карточками

Карточки можно изучать в боте или в Mini App.

**Работа в боте:**

1. **Вызов карточки:**
   - Кнопка "Взять карточку" отображается под каждым сообщением бота
   - Не отображается, если уже показаны другие интерактивные кнопки (например, "Добавить в карточки")
   - Бот выбирает наиболее актуальную для повторения карточку по алгоритму

2. **Отображение карточки:**
   - Показывается слово с примером использования
   - Сторона карточки (изучаемый язык или русский) выбирается случайно
   - Кнопка "Перевернуть карточку" добавляет в сообщение перевод слова и примера

3. **Оценка знания:**
   - После переворота появляются кнопки: "Не знаю", "Повторить", "Знаю"
   - В зависимости от ответа выбирается интервал следующего повторения
   - Используется алгоритм интервального повторения (как в Anki)

**Работа в Mini App:**

- Карточка переворачивается визуально (анимация)
- Можно переворачивать неограниченное количество раз
- После первого переворота становятся доступны кнопки оценки: "Не знаю", "Повторить", "Знаю"

**Привязка к профилю:**
Карточки привязаны к активному языковому профилю пользователя.

### UC-4: Выполнение упражнений

**Типы тем для упражнений:**

1. **Жизненные темы:**
   - Работа, бизнес, путешествия и т.д.
   - Бот генерирует предложения для перевода по теме
   - Учитывается уровень пользователя

2. **Грамматические темы:**
   - Прошедшее время, падежи, артикли и т.д.
   - Бот дает задания на трансформацию (например, настоящее → прошедшее)
   - Учитывается уровень пользователя

**Форматы упражнений:**

- **В боте:** только текстовые ответы
- **В Mini App:**
  - Свободный ввод текста с проверкой LLM
  - Выбор правильного варианта из предложенных (один правильный, остальные правдоподобные, но неверные)

**Управление темами:**

1. **Добавление тем:**
   - Через свободный текст: "Добавь тему прошедшего времени"
   - Через команду: `/add_topic "название темы"`
   - Доступно в боте и Mini App

2. **Удаление тем:**
   - Только через Mini App

3. **Выбор активной темы:**
   - Команда `/topics` отображает все темы постранично (inline кнопки)
   - Пользователь выбирает тему, нажав на кнопку
   - Активная тема используется для генерации упражнений

**Получение упражнений в боте:**

- Кнопка "Упражнение" отображается под каждым сообщением бота (рядом с "Взять карточку")
- Кнопка доступна только если у пользователя есть темы для изучения
- Генерируется упражнение по активной теме

**Привязка к профилю:**
Темы упражнений привязаны к активному языковому профилю пользователя.

### UC-5: Работа с изображениями

**Распознавание текста (OCR):**

- Бот распознает текст на изучаемом языке из изображения (сжатого или несжатого)
- Если текст найден — присылает распознанный текст в ответ
- Если текст на изучаемом языке не найден — сообщает об этом

**Предложение добавить в карточки:**

- Бот анализирует распознанный текст
- Находит слова и устойчивые выражения, которых нет в карточках пользователя
- Выбирает наиболее ценные/популярные слова
- Предлагает добавить их в карточки (inline кнопки)

**Работа с изображением + текстовым запросом:**

1. **Перевод:**
   - Пользователь присылает фото с просьбой перевести
   - Бот распознает и переводит текст

2. **Проверка упражнения/домашнего задания:**
   - Фото учебника или рукописного текста
   - Пользователь описывает суть задания
   - Бот проверяет и дает обратную связь

3. **Решение задания:**
   - Фото с упражнением (пропуски, тест и т.д.)
   - Бот предлагает решение с объяснением

### UC-6: Голосовые сообщения

**Распознавание речи (Speech-to-Text):**

- Пользователь присылает голосовое сообщение
- Бот распознает речь и преобразует в текст
- Работает с распознанным текстом по стандартным сценариям (ответ, перевод и т.д.)

**Оценка произношения:**

- Если голосовое сообщение на изучаемом языке
- Бот может оценить произношение и дать рекомендации (при наличии технической возможности)

**Формат ответа:**

- Бот отвечает текстовым сообщением
- Возможность добавить в карточки, как при обычном текстовом взаимодействии

### UC-7: Участие в группе обучения

**Доступ к материалам группы:**

- Участнику группы становятся доступны темы для изучения, предоставленные создателем группы
- Участнику группы становятся доступны колоды с карточками, предоставленные создателем группы

**Ограничения:**

- Участники не могут редактировать материалы, созданные другими пользователями
- Материалы доступны только для изучения и практики

**Синхронизация:**

- При обновлении материалов создателем изменения автоматически отражаются у всех участников группы

### UC-8: Отслеживание прогресса

**Доступ к статистике:**

- Через команду `/stats` в боте
- Через раздел статистики в Mini App

**Метрики (по каждому профилю):**

- Количество изученных карточек
- Количество выполненных упражнений
- Количество заданных вопросов боту
- Текущий стрик (дни обучения подряд)

**Система стриков:**

- Стрик — количество дней непрерывного обучения
- Для поддержания стрика нужно выполнить хотя бы одно действие (карточка, упражнение, вопрос)

**Уведомления о стрике:**

- Если стрик > 1 дня и сегодня еще не закрыт — уведомление за 6 часов до конца дня
- После разрыва стрика уведомления больше не приходят (пока пользователь не начнет новый стрик)
- Уведомление персонализированное, генерируется через LLM

### UC-9: Создание и управление группой

**Возможности:**

- Любой пользователь может создавать и управлять группами
- Можно создать несколько групп
- Создатель группы имеет полные права управления своей группой

**Добавление участников:**

- Команда: `/add_to_group <user>`
- Идентификатор пользователя может быть:
  - Chat ID
  - Nickname/username
  - Ссылка на Telegram профиль

**Процесс приглашения:**

1. Создатель группы отправляет команду с идентификатором пользователя
2. Если пользователь не найден среди пользователей бота — возвращается ошибка
3. Если пользователь найден — ему отправляется приглашение в группу
4. Пользователь принимает или отклоняет приглашение
5. Создатель группы получает уведомление о решении пользователя 

### UC-10: Создание и распространение материалов для участников группы

**Создание материалов:**

- Любой пользователь может создавать темы для упражнений
- Любой пользователь может создавать колоды карточек

**Предоставление доступа к материалам:**

- Доступно только через Mini App (не через бота)
- Можно предоставить доступ одной или нескольким группам
- При предоставлении доступа участники группы получают уведомление

**Синхронизация изменений:**

- При изменении создателем материалов (тем или колод)
- Изменения автоматически отражаются у всех участников, имеющих доступ 

## Сценарии администратора

### UC-11: Управление подписками

**Автоматическая активация:**

- Интеграция с платежной системой Stripe
- При успешной оплате подписки на месяц пользователю автоматически активируется премиум-статус

**Просмотр пользователей:**

- Администратор может просматривать список пользователей через Mini App
- Отображается статус подписки каждого пользователя

**Ручная активация:**

- Администратор может вручную активировать премиум-статус через Mini App
- Используется для промо-акций, компенсаций и особых случаев

### UC-12: Мониторинг системы

**Просмотр списка пользователей:**

- Доступ через Mini App
- Базовая информация о пользователях:
  - Имя, фамилия
  - Изучаемые языки
  - Уровень владения языком
  - Дата регистрации
  - Статус подписки (премиум/бесплатный)

**Метрики активности:**

- Количество заданных вопросов боту
- Количество просмотренных карточек
- Количество выполненных упражнений

**Цель:**
Мониторинг вовлеченности пользователей и общей активности в системе.
